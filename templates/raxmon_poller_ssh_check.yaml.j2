type              : remote.tcp
label             : "SSH"
# TODO(mariojv) Templatize period/timeout like in lb_api checks
period            : "60"
timeout           : "15"
# TODO(mariojv) May want to also templatize disabled like in lb_api checks
disabled          : "false"
target_hostname   : "{{ ip_address }}"
# TODO(mariojv) Can we always assume port 22 for these deployments, or need to
# templatize?
details           :
  port            : 22
  banner_match    : "SSH"
monitoring_zones_poll:
{% for zone in maas_private_monitoring_zones %}
  - {{ zone }}
{% endfor %}
metadata          :
  event-type-override: "ssh"
alarms            :
  Banner_Match              :
        label               : "Banner Match"
        notification_plan_id: "{{ maas_notification_plan }}"
        disabled            : false
        criteria            : |
            :set consecutiveCount=3
            if (metric['banner_match'] == "") {
                return new AlarmStatus(CRITICAL, 'Banner not found. Expected: SSH');
            }
            return new AlarmStatus(OK, 'SSH service responds as expected.');
